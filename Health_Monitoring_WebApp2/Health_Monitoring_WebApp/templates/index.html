<!-- templates/index.html -->
{% extends "base.html" %}

{% block content %}
<div class="content">
    <h1>Patient Information</h1>
    
    <form method="POST" action="{{ url_for('index') }}">
        <div class="form-group">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" value="{{ patient_info.name }}" placeholder="Enter full name" required>
        </div>
        
        <div class="form-group">
            <label for="age">Age:</label>
            <input type="number" id="age" name="age" value="{{ patient_info.age }}" placeholder="Enter age" required>
        </div>
        
        <div class="form-group">
            <label for="gender">Gender:</label>
            <select id="gender" name="gender" required>
                <option value="" {% if not patient_info.gender %}selected{% endif %}>Select Gender</option>
                <option value="Male" {% if patient_info.gender == 'Male' %}selected{% endif %}>Male</option>
                <option value="Female" {% if patient_info.gender == 'Female' %}selected{% endif %}>Female</option>
                <option value="Other" {% if patient_info.gender == 'Other' %}selected{% endif %}>Other</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="weight">Weight (kg):</label>
            <input type="number" id="weight" name="weight" step="0.1" value="{{ patient_info.weight }}" placeholder="Enter weight in kg" required>
        </div>
        
        <button type="submit">Fetch Health Data</button>
    </form>

    {% if latest_data %}
    <div class="metric">
        <h2>Current Health Readings</h2>
        <table>
            <tr>
                <th>Parameter</th>
                <th>Value</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>Pulse BPM</td>
                <td>{{ latest_data.field1 }}</td>
                <td class="{% if status.bpm == 'Normal' %}normal{% else %}abnormal{% endif %}">{{ status.bpm }}</td>
            </tr>
            <tr>
                <td>Pulse Oximeter (%)</td>
                <td>{{ latest_data.field2 }}</td>
                <td class="{% if status.o2 == 'Normal' %}normal{% else %}abnormal{% endif %}">{{ status.o2 }}</td>
            </tr>
            <tr>
                <td>Body Temperature (F)</td>
                <td>{{ latest_data.field3 }}</td>
                <td class="{% if status.body_temp == 'Normal' %}normal{% else %}abnormal{% endif %}">{{ status.body_temp }}</td>
            </tr>
        </table>
    </div>
    <button onclick="printGraphs()">Generate Report</button>
    {% endif %}
</div>
<script>
function printGraphs() {
    // Clone the entire content section
    const content = document.querySelector('.content').cloneNode(true);
    
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write(`
        <html>
            <head>
                <title>Health Report</title>
                <style>
                    table { border-collapse: collapse; margin: 20px 0; }
                    td, th { border: 1px solid #000; padding: 8px; }
                    .form-group { margin-bottom: 15px; }
                    input, select { border: none; } /* Remove input borders for print */
                </style>
            </head>
            <body>
                ${content.innerHTML}
            </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}
</script>
{% endblock %}


